<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Karteczki Leaderboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="secret.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f8;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-top: 40px;
      color: #555;
    }

    #signin-form {
      text-align: center;
      margin-bottom: 40px;
    }

    input {
      padding: 8px;
      margin: 5px;
      font-size: 1em;
    }

    button[type="submit"] {
      background-color: #3498db;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #playerList {
      margin: 0 auto;
      width: 90%;
      max-width: 1000px;
      border-collapse: collapse;
    }

    #playerList th,
    #playerList td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    #playerList th {
      background-color: #2c3e50;
      color: white;
    }

    #playerList tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    #playerList tr:hover {
      background-color: #f1f1f1;
    }

    .action-button {
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 0.9em;
      cursor: pointer;
      color: white;
      transition: background-color 0.3s ease;
    }

    .yellow {
      background-color: #f1c40f;
    }

    .yellow:hover {
      background-color: #d4ac0d;
    }

    .green {
      background-color: #2ecc71;
    }

    .green:hover {
      background-color: #27ae60;
    }

    .red {
      background-color: #e74c3c;
    }

    .red:hover {
      background-color: #c0392b;
    }

    #message {
      text-align: center;
      margin: 20px;
    }
  </style>
</head>

<body>
  <h1>Karteczki Leaderboard</h1>

  <h2>Sign In</h2>
  <form id="signin-form">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button type="submit">Sign In</button>
  </form>

  <div id="message"></div>

  <h2>Leaderboard</h2>
  <table id="playerList">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>游리 Yellow</th>
        <th>游릭 Green</th>
        <th>游댮 Red</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="playerBody">
      <!-- Filled dynamically -->
    </tbody>
  </table>

  <script>
    const SUPABASE_URL = SECRET.API_URL;
    const SUPABASE_KEY = SECRET.API_KEY;
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            

    const form = document.getElementById('signin-form');
    const messageDiv = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        messageDiv.textContent = 'Error: ' + error.message;
        messageDiv.style.color = 'red';
      } else {
        messageDiv.textContent = 'Signed in as ' + data.user.email;
        messageDiv.style.color = 'green';
        loadPlayers();
      }
    });

    async function loadPlayers() {
      const { data, error } = await supabase.from('karteczki').select('*');
      const tbody = document.getElementById('playerBody');
      tbody.innerHTML = '';

      if (error || !data) return;

      data.sort((a, b) => {
        const aTotal = a.red_cards * 100 + a.yellow_cards * 10 + a.green_cards;
        const bTotal = b.red_cards * 100 + b.yellow_cards * 10 + b.green_cards;
        return bTotal - aTotal;
      });

      data.forEach((player, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td><strong>${player.name}</strong></td>
          <td>${player.yellow_cards}</td>
          <td>${player.green_cards}</td>
          <td>${player.red_cards}</td>
          <td>
            <button class="action-button yellow" data-id="${player.id}" data-type="yellow">+游리</button>
            <button class="action-button green" data-id="${player.id}" data-type="green">+游릭</button>
            <button class="action-button red" data-id="${player.id}" data-type="red">+游댮</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      document.querySelectorAll('button[data-id]').forEach(button => {
        button.addEventListener('click', async () => {
          const id = button.getAttribute('data-id');
          const type = button.getAttribute('data-type');
          await incrementCardCount(id, type);
          loadPlayers(); // Refresh
        });
      });
    }

    async function incrementCardCount(id, type) {
      const { data, error } = await supabase.from('karteczki').select('*').eq('id', id).single();
      if (error || !data) return;

      const updated = {
        yellow_cards: data.yellow_cards,
        green_cards: data.green_cards,
        red_cards: data.red_cards
      };

      updated[`${type}_cards`] += 1;

      await supabase.from('karteczki').update(updated).eq('id', id);
    }

    // Optional: auto-load if already signed in
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session) loadPlayers();
    });
  </script>
</body>

</html>
