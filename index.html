<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Karteczki</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f8;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            padding: 20px;
            color: #333;
        }

        #playerList {
            list-style: none;
            padding: 0;
            max-width: 800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        li {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        li strong {
            font-size: 1.2em;
            color: #222;
        }

        .card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button {
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 1em;
            cursor: pointer;
            color: white;
            transition: background-color 0.3s ease;
        }

        button[data-type="yellow"] {
            background-color: #f1c40f;
        }

        button[data-type="yellow"]:hover {
            background-color: #d4ac0d;
        }

        button[data-type="green"] {
            background-color: #2ecc71;
        }

        button[data-type="green"]:hover {
            background-color: #27ae60;
        }

        button[data-type="red"] {
            background-color: #e74c3c;
        }

        button[data-type="red"]:hover {
            background-color: #c0392b;
        }
    </style>
</head>

<body>

    <h1>Karteczki</h1>
    <h2>Sign In</h2>
    <form id="signin-form">
        <label>Email: <input type="email" id="email" required /></label><br />
        <label>Password: <input type="password" id="password" required /></label><br />
        <button type="submit">Sign In</button>
    </form>
    <h2>Karteczki</h2>
    <ul id="playerList"></ul>
    <div id="message">
    </div>
    <script>
        const SUPABASE_URL = 'https://craxqjxixhzwrzqrnvju.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyYXhxanhpeGh6d3J6cXJudmp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMzA2ODgsImV4cCI6MjA2NDkwNjY4OH0.wFbarwUJowhT93Rcf6MfbrrAQjHXF8GjxYzNak-pmMo';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const form = document.getElementById('signin-form');
            const messageDiv = document.getElementById('message');

            form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Call Supabase auth sign in
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                messageDiv.textContent = 'Error: ' + error.message;
                messageDiv.style.color = 'red';
            } else {
                messageDiv.textContent = 'Signed in successfully! Welcome, ' + data.user.email;
                messageDiv.style.color = 'green';
                // You can redirect or load user-specific content here
            }
            });
        async function loadPlayers() {
            const { data, error } = await supabase.from('karteczki').select('*');
            const list = document.getElementById('playerList');
            list.innerHTML = '';
            data.sort((a, b) => {
                if(a.red_cards == b.red_cards){
                    return a.yellow_cards < b.yellow_cards
                }
                return a.red_cards < b.red_cards;
            }
            );

            data.forEach(player => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${player.name}</strong>
                    <div class="card-row">ðŸŸ¡ Yellow: ${player.yellow_cards} <button data-id="${player.id}" data-type="yellow">+</button></div>
                    <div class="card-row">ðŸŸ¢ Green: ${player.green_cards} <button data-id="${player.id}" data-type="green">+</button></div>
                    <div class="card-row">ðŸ”´ Red: ${player.red_cards} <button data-id="${player.id}" data-type="red">+</button></div>
                `;
                list.appendChild(li);
            });

            document.querySelectorAll('button[data-id]').forEach(button => {
                button.addEventListener('click', async () => {
                    const id = button.getAttribute('data-id');
                    const type = button.getAttribute('data-type');
                    await incrementCardCount(id, type);
                    loadPlayers(); // Refresh
                });
            });
        }

        async function incrementCardCount(id, type) {
            const { data, error } = await supabase
                .from('karteczki')
                .select('*')
                .eq('id', id)
                .single();

            if (error || !data) return console.error('Failed to fetch player', error);

            const updated = {
                yellow_cards: data.yellow_cards,
                green_cards: data.green_cards,
                red_cards: data.red_cards
            };

            updated[`${type}_cards`] += 1;

            await supabase
                .from('karteczki')
                .update(updated)
                .eq('id', id);
        }

        loadPlayers();
    </script>
</body>

</html>
